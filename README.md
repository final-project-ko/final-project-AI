# 오늘은- 백엔드(java)와 인공지능(Python) 서버와의 결합

### java서버 (=백엔드 서버)

#### Entity및 Dto로 Mysql데이터 호출 및 가공해 python에 전송

기능

1. java DTO에서 Python으로 데이터를 로드합니다.
1-1. java에서 get요청을 보내 python서버와 연결되어 있는지 확인합니다. (연결되지 않으면 요청을 보내지 않음)
1-2. 연결이 확인되면 지정된 스케줄러에 따라 4종류의 Api를 호출하게 됩니다.

---
### python서버 (=인공지능 서버 (별도로 구동되는 백엔드 서버의 일부입니다))

#### 전달 받은 데이터를 ai모델에 넣고 출력된 결과물을 db에 전송

#### google gemeni-pro 모델을 사용합니다.

기능

1. langchain으로 py모델에 gemini모델을 결합합니다.   
1-1. 뉴스 데이터의 내용을 불러오고, 1000~2000자 이내의 내용 요약본을 생성  
2. java에서 전송 받은 데이터를 문자열 정형화 및 통합 등의 기능으로 가공합니다.
3. ai모델에서 가공합니다. 현재 gemini는 api요청 기능을 지원하고 있어, 그 방법으로 사용합니다. (한번 응답 시 15~60초 이내 소요)  
4. java에서 받아온 code를 추척해, 받은 데이터를 해당 설명과 같은 코드의 db에 저장합니다.
5. ai_description 컬럼에 내용이 추가됩니다.

#### 1-2. 뉴스 데이터의 내용을 불러오고, 영어 원문을 1000~2000자 이내 한글로 번역
2. java에서 전송 받은 데이터를 정형화합니다. 1번과 다르게 ai_description 데이터를 불러옵니다.  
2-1. 만약 ai_description데이터가 null이라면, 요청이 생략됩니다. (java)
3. ai모델에서 가공합니다.
4. java에서 받아온 code를 추척해, 받은 데이터를 해당 설명과 같은 코드의 db에 저장합니다.
5. trans_description 컬럼에 내용이 추가됩니다.

####  1-3. 뉴스 데이터의 모든 title들을 불러와 통합하고, 1000~2000자 이내의 페이지 5페이지로 요약본을 생성
2. java에서 전송 받은 데이터를 정형화합니다.

3. title데이터를 랜덤으로 50개 불러와 각각 10개씩 통합하고, 1500자로 가공해 전달합니다. 총 5번 전달합니다.(java)


4. ai모델에서 가공합니다. for문으로 총 5번 전달됩니다.


5. 받은 데이터를 db에 저장합니다.
4-1. java스케줄러로 정기적으로 데이터를 삭제합니다. 삭제할 시 *컬럼 자체가 없어지는 상태로*, Python서버를 거칠 때마다 code번호 1번으로 재생성됩니다.
6. tbl_summary_news테이블 summary_news_1~5 컬럼에 추가됩니다. summary_news_code는 1번만 사용합니다.

####  1-4. 뉴스 데이터의 모든 title들을 불러와 통합하고, 오늘의 이슈 키워드를 10개 생성
2. java에서 전송 받은 데이터를 정형화합니다.


2. title데이터를 모두 통합하고, 1500자로 가공해 전달합니다. (java)
3. ai모델에서 가공합니다.
4. 받은 데이터를 해당 설명과 같은 코드의 db에 저장합니다.  
5-1. java스케줄러로 정기적으로 데이터를 삭제합니다. 삭제할 시 *컬럼 자체가 없어지는 상태로*, Python서버를 거칠 때마다 code번호 1번으로 재생성됩니다.
5. tbl_keyword_news테이블 keyword_1~15 컬럼에 추가됩니다. keyword_news_code 1번만 사용합니다.  
6-1. 만약 출력된 키워드 개수가 부족할 시,  keyword_1~15컬럼이 null상태로 남을 가능성이 있습니다. 
7. 실제 사용시에는 10개까지만 사용해주세요. (5개는 여분 데이터)

---
### [주의사항]

1. 상황에 따라 데이터가 null일 가능성이 높습니다. 데이터가 검열되어 호출 받지 못했거나, ai가 완벽하지 않은 결과를 주었다던가...
if문을 사용해서 오류 케이스를 만들어주시는게 좋습니다.  


2. 출력 데이터에 '**', '/n'이 들어갈 가능성이 있습니다. js에서 데이터를 보여줄 시 문자를 정형화해주시는게 좋습니다.
(어플리케이션-요약뉴스 screen은 문자 정형화가 되어 있을겁니다!)

---
###  [ AI 설명 + 번역 DB ]

#### tbl_news 테이블

1. ai_description 컬럼
- varchar(1000) (String)
- description 데이터를 ai로 가공해 저장한 데이터입니다.
- 최근 기사를 우선적으로 가공합니다. *코드번호 순서가 아닙니다!*
- 수위 가이드라인 및 검열에 의해 일부 데이터가 gemini에 들어가지 못하고 null상태로 남는 경우가 있습니다.

1. trans_description 컬럼
- varchar(3000) (String)
- ai_description 데이터를 ai로 가공해 저장한 데이터입니다.
- 최근 기사를 우선적으로 가공합니다. *코드번호 순서가 아닙니다!*
- 수위 가이드라인 및 검열에 의해 일부 데이터가 gemini에 들어가지 못하고 null상태로 남는 경우가 있습니다.
- 영어 데이터만 가공합니다. ai_description이 한글부터 생성되기 때문에, 초기 실행 시 작동까지 오래 걸립니다.

#### tbl_keyword_news 테이블

1. keyword_news_code
- 1번 데이터만 사용합니다.
1. keyword_1, keyword_2..... keyword_15 (총 15개)
2. date

#### tbl_summary_news 테이블

1. summary_news_code - 1번 데이터만 사용합니다.
2. summary_news_1, summary_news_2..... summary_news_5 (총 5개)
3. date